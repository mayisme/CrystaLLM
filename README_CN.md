# CrystaLLM - é’™é’›çŸ¿ç”ŸæˆæŒ‡å—ï¼ˆä¸­æ–‡ç‰ˆï¼‰

[English Version](README.md) | ä¸­æ–‡ç‰ˆ

## ç®€ä»‹

CrystaLLM æ˜¯ä¸€ä¸ªåŸºäº Transformer æ¶æ„çš„å¤§å‹è¯­è¨€æ¨¡å‹ï¼Œä¸“é—¨ç”¨äºç”Ÿæˆæ™¶ä½“ç»“æ„çš„ CIF (Crystallographic Information File) æ ¼å¼æ–‡ä»¶ã€‚æœ¬é¡¹ç›®ç‰¹åˆ«é€‚åˆç”Ÿæˆ**ç¨³å®šçš„é’™é’›çŸ¿ç»“æ„**ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®è¿è¡Œæ¼”ç¤º

```bash
cd examples
./quickstart.sh
```

è¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨ï¼š
1. æ£€æŸ¥å¹¶å®‰è£…å¿…è¦çš„ä¾èµ–
2. ä¸‹è½½é’™é’›çŸ¿ä¸“ç”¨æ¨¡å‹
3. ç”Ÿæˆæ ·ä¾‹é’™é’›çŸ¿ç»“æ„ï¼ˆCaTiOâ‚ƒ, SrTiOâ‚ƒ, BaTiOâ‚ƒï¼‰
4. åˆ†æå¹¶è¯„ä¼°ç”Ÿæˆçš„ç»“æ„
5. ç”Ÿæˆè¯¦ç»†çš„è´¨é‡æŠ¥å‘Š

### æ‰¹é‡ç”Ÿæˆé’™é’›çŸ¿

```bash
# ç”Ÿæˆå¸¸è§é’™é’›çŸ¿ç»“æ„
python examples/generate_perovskites.py \
    --model crystallm_perov_5_small \
    --output perovskites/ \
    --num-samples 20

# è‡ªå®šä¹‰ç»„æˆå’Œç©ºé—´ç¾¤
python examples/generate_perovskites.py \
    --model crystallm_perov_5_small \
    --output my_perovskites/ \
    --compositions "CaTiO3:Pm-3m,SrTiO3:Pm-3m,BaTiO3:P4mm" \
    --num-samples 50 \
    --temperature 0.7
```

### åˆ†æç”Ÿæˆçš„ç»“æ„

```bash
# å…¨é¢åˆ†æå’Œè¯„ä¼°
python examples/analyze_perovskites.py \
    --input perovskites/ \
    --output analysis/

# ä»…ç­›é€‰é«˜è´¨é‡ç»“æ„ï¼ˆâ‰¥80åˆ†ï¼‰
python examples/analyze_perovskites.py \
    --input perovskites/ \
    --output analysis/ \
    --min-quality 80 \
    --valid-only
```

## ğŸ“š è¯¦ç»†æ–‡æ¡£

### 1. [é’™é’›çŸ¿ç”Ÿæˆå®Œæ•´æŒ‡å—](PEROVSKITE_GENERATION_GUIDE.md)

è¿™æ˜¯ä¸€ä»½å…¨é¢çš„ä¸­æ–‡æŒ‡å—ï¼ŒåŒ…å«ï¼š

- **é¡¹ç›®æ¦‚è¿°**ï¼šCrystaLLM çš„æ ¸å¿ƒåŸç†å’Œæ¶æ„
- **ä»£ç åˆ†æ**ï¼šè¯¦ç»†è§£æå„ä¸ªæ¨¡å—çš„åŠŸèƒ½
- **ç”Ÿæˆæ–¹æ³•**ï¼š
  - æ–¹æ³•ä¸€ï¼šä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹å¿«é€Ÿç”Ÿæˆ
  - æ–¹æ³•äºŒï¼šä½¿ç”¨ MCTS ç”Ÿæˆé«˜è´¨é‡ç»“æ„
  - æ–¹æ³•ä¸‰ï¼šè®­ç»ƒä¸“ç”¨é’™é’›çŸ¿æ¨¡å‹
- **å‚æ•°è°ƒä¼˜**ï¼šå¦‚ä½•è°ƒæ•´å‚æ•°ä»¥è·å¾—æ›´ç¨³å®šçš„ç»“æ„
- **å®è·µæ¡ˆä¾‹**ï¼šçœŸå®çš„ä½¿ç”¨åœºæ™¯å’Œç¤ºä¾‹ä»£ç 
- **é«˜çº§æŠ€æœ¯**ï¼šMCTS è§£ç å’Œè‡ªå®šä¹‰è¯„åˆ†å‡½æ•°

### 2. [ç¤ºä¾‹è„šæœ¬æ–‡æ¡£](examples/README.md)

åŒ…å«ä¸¤ä¸ªä¸»è¦çš„ Python è„šæœ¬ï¼š

#### `generate_perovskites.py` - æ‰¹é‡ç”Ÿæˆè„šæœ¬
- æ”¯æŒé¢„è®¾çš„å¸¸è§é’™é’›çŸ¿åˆ—è¡¨
- å¯è‡ªå®šä¹‰åŒ–å­¦ç»„æˆå’Œç©ºé—´ç¾¤
- è‡ªåŠ¨åå¤„ç†
- ç”Ÿæˆè¯¦ç»†æŠ¥å‘Š

#### `analyze_perovskites.py` - åˆ†æå’Œç­›é€‰è„šæœ¬
- éªŒè¯ CIF æ–‡ä»¶æœ‰æ•ˆæ€§
- è®¡ç®— Goldschmidt å®¹å¿å› å­
- è¯„ä¼°é”®é•¿åˆç†æ€§
- æ£€æŸ¥ç©ºé—´ç¾¤ä¸€è‡´æ€§
- ç»¼åˆè´¨é‡è¯„åˆ†ï¼ˆ0-100åˆ†ï¼‰
- è‡ªåŠ¨ç­›é€‰é«˜è´¨é‡ç»“æ„

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. è´¨é‡è¯„ä¼°æŒ‡æ ‡

ç”Ÿæˆçš„ç»“æ„ä¼šæ ¹æ®ä»¥ä¸‹æ ‡å‡†è¿›è¡Œè¯„åˆ†ï¼š

| æŒ‡æ ‡ | åˆ†å€¼ | è¯´æ˜ |
|------|------|------|
| ç»“æ„æœ‰æ•ˆæ€§ | 40åˆ† | CIF æ ¼å¼æ­£ç¡®ï¼Œå¯æ„å»ºæœ‰æ•ˆæ™¶ä½“ç»“æ„ |
| ç©ºé—´ç¾¤ä¸€è‡´æ€§ | 20åˆ† | ç”Ÿæˆçš„ç»“æ„ç¬¦åˆå£°æ˜çš„ç©ºé—´ç¾¤ |
| åŸå­ä½ç‚¹é‡æ•°ä¸€è‡´æ€§ | 15åˆ† | åŸå­å æ®åˆç†ï¼Œé‡æ•°ä¸å¯¹ç§°æ€§åŒ¹é… |
| é”®é•¿åˆç†æ€§ | 15åˆ† | åŸå­é—´è·åœ¨åˆç†èŒƒå›´å†… |
| å®¹å¿å› å­ç¨³å®šæ€§ | 10åˆ† | Goldschmidt å®¹å¿å› å­åœ¨ 0.8-1.0 |

**æ€»åˆ† 100 åˆ†**ï¼Œå»ºè®®é€‰æ‹©å¾—åˆ† â‰¥ 80 åˆ†çš„ç»“æ„ã€‚

### 2. é’™é’›çŸ¿ç¨³å®šæ€§è¯„ä¼°

å¯¹äº ABXâ‚ƒ å‹é’™é’›çŸ¿ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨è®¡ç®— Goldschmidt å®¹å¿å› å­ï¼š

```
t = (r_A + r_X) / (âˆš2 Ã— (r_B + r_X))
```

- **ç¨³å®š** (0.8 â‰¤ t â‰¤ 1.0)ï¼šå¯èƒ½å½¢æˆç¨³å®šçš„é’™é’›çŸ¿ç»“æ„
- **è¾¹ç¼˜ç¨³å®š** (0.7 â‰¤ t < 0.8)ï¼šå¯èƒ½ç¨³å®šï¼Œéœ€è¿›ä¸€æ­¥éªŒè¯
- **ä¸ç¨³å®š** (t < 0.7 æˆ– t > 1.0)ï¼šä¸å¤ªå¯èƒ½å½¢æˆé’™é’›çŸ¿ç»“æ„

### 3. æ”¯æŒçš„é’™é’›çŸ¿ç±»å‹

#### æ°§åŒ–ç‰©é’™é’›çŸ¿
- CaTiOâ‚ƒ, SrTiOâ‚ƒ, BaTiOâ‚ƒ (é’›é…¸ç›)
- PbTiOâ‚ƒ, KNbOâ‚ƒ (é“ç”µææ–™)
- LaAlOâ‚ƒ (åŸºæ¿ææ–™)

#### å¤åŒ–ç‰©é’™é’›çŸ¿
- CsPbIâ‚ƒ, CsPbBrâ‚ƒ (å…¨æ— æœºé’™é’›çŸ¿å¤ªé˜³èƒ½ç”µæ± )
- CsSnIâ‚ƒ (æ— é“…é’™é’›çŸ¿)
- MAPbIâ‚ƒ (æœ‰æœº-æ— æœºæ‚åŒ–é’™é’›çŸ¿)

#### åŒé’™é’›çŸ¿
- Srâ‚‚FeMoOâ‚†, Baâ‚‚NiWOâ‚†

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### æé«˜ç»“æ„ç¨³å®šæ€§

1. **é™ä½é‡‡æ ·æ¸©åº¦**ï¼šä½¿ç”¨ `--temperature 0.6-0.7`
2. **å‡å° Top-K å€¼**ï¼šä½¿ç”¨ `--top-k 5-8`
3. **å¢åŠ æ ·æœ¬æ•°**ï¼šä½¿ç”¨ `--num-samples 50-100`ï¼Œç„¶åç­›é€‰æœ€ä½³ç»“æ„
4. **æŒ‡å®šç©ºé—´ç¾¤**ï¼šä¸ºå·²çŸ¥çš„é’™é’›çŸ¿æŒ‡å®šå…¸å‹ç©ºé—´ç¾¤

### æé«˜ç”Ÿæˆå¤šæ ·æ€§

1. **æé«˜é‡‡æ ·æ¸©åº¦**ï¼šä½¿ç”¨ `--temperature 0.9-1.1`
2. **å¢å¤§ Top-K å€¼**ï¼šä½¿ç”¨ `--top-k 20-30`
3. **ä¸æŒ‡å®šç©ºé—´ç¾¤**ï¼šè®©æ¨¡å‹è‡ªç”±æ¢ç´¢

### ä½¿ç”¨ MCTS ä¼˜åŒ–

å¯¹äºé‡è¦çš„ç»„æˆï¼Œå»ºè®®ä½¿ç”¨ MCTS æ–¹æ³•ï¼š

```bash
# åˆ›å»ºæç¤ºæ–‡ä»¶
python bin/make_prompt_file.py CaTiO3 catio3_prompt.txt --spacegroup Pm-3m

# ä½¿ç”¨ MCTS ç”Ÿæˆ
python bin/mcts.py \
    out_dir=crystallm_perov_5_small \
    start=FILE:catio3_prompt.txt \
    num_simulations=300 \
    tree_width=10 \
    mcts_out_dir=catio3_mcts \
    device=cuda
```

## ğŸ“Š è¾“å‡ºç¤ºä¾‹

### ç”ŸæˆæŠ¥å‘Šç¤ºä¾‹
```
é’™é’›çŸ¿ç»“æ„ç”ŸæˆæŠ¥å‘Š
============================================================

æ¨¡å‹: crystallm_perov_5_small
ç”Ÿæˆå‚æ•°:
  - æ¯ç§ç»„æˆæ ·æœ¬æ•°: 20
  - æ¸©åº¦: 0.75
  - Top-K: 10
  - è®¾å¤‡: cuda

ç”Ÿæˆç»“æœ:
------------------------------------------------------------

CaTiO3:
  çŠ¶æ€: âœ“ æˆåŠŸ
  ç”Ÿæˆæ•°é‡: 20
  å¤„ç†åæ–‡ä»¶: results/perovskites/CaTiO3/processed/

SrTiO3:
  çŠ¶æ€: âœ“ æˆåŠŸ
  ç”Ÿæˆæ•°é‡: 20
  å¤„ç†åæ–‡ä»¶: results/perovskites/SrTiO3/processed/
```

### åˆ†ææŠ¥å‘Šç¤ºä¾‹
```
æ€»ä½“ç»Ÿè®¡:
----------------------------------------------------------------------
æ€»æ–‡ä»¶æ•°: 60
æˆåŠŸåˆ†æ: 58
åˆ†æå¤±è´¥: 2

ç»“æ„æœ‰æ•ˆæ€§:
----------------------------------------------------------------------
æœ‰æ•ˆç»“æ„: 54/60 (90.0%)
ç©ºé—´ç¾¤ä¸€è‡´: 56/60 (93.3%)
é‡æ•°ä¸€è‡´: 57/60 (95.0%)
å¹³å‡é”®é•¿åˆç†æ€§: 0.973

è´¨é‡åˆ†æ•°åˆ†å¸ƒ:
----------------------------------------------------------------------
å¹³å‡è´¨é‡åˆ†æ•°: 78.3/100
ä¼˜ç§€ (â‰¥80åˆ†): 25 (41.7%)
è‰¯å¥½ (60-79åˆ†): 28 (46.7%)
ä¸€èˆ¬ (40-59åˆ†): 5 (8.3%)
è¾ƒå·® (<40åˆ†): 2 (3.3%)

Goldschmidt å®¹å¿å› å­:
----------------------------------------------------------------------
å¹³å‡å€¼: 0.912
ç¨³å®šæ€§è¯„ä¼°:
  ç¨³å®š (0.8-1.0): 48
  è¾¹ç¼˜ç¨³å®š (0.7-0.8): 6
  ä¸ç¨³å®š (<0.7 or >1.0): 4
```

## ğŸ”§ å®‰è£…å’Œä¾èµ–

### åŸºæœ¬ä¾èµ–
```bash
pip install torch==2.0.1
pip install -r requirements.txt
pip install -e .
```

### åˆ†æè„šæœ¬é¢å¤–ä¾èµ–
```bash
pip install pymatgen pandas tqdm
```

## ğŸ“– å®Œæ•´å·¥ä½œæµç¨‹

```bash
# 1. å‡†å¤‡ç¯å¢ƒ
cd /path/to/CrystaLLM
pip install -r requirements.txt
pip install -e .

# 2. ä¸‹è½½æ¨¡å‹
python bin/download.py crystallm_perov_5_small.tar.gz
tar xzf crystallm_perov_5_small.tar.gz

# 3. ç”Ÿæˆç»“æ„
python examples/generate_perovskites.py \
    --model crystallm_perov_5_small \
    --output results/perovskites \
    --num-samples 20

# 4. åˆ†æç»“æ„
python examples/analyze_perovskites.py \
    --input results/perovskites \
    --output results/analysis

# 5. æŸ¥çœ‹ç»“æœ
cat results/analysis/analysis_report.txt
cat results/analysis/high_quality_structures.csv
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤é—®é¢˜æŠ¥å‘Šå’Œæ”¹è¿›å»ºè®®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®éµå¾ªåŸ CrystaLLM é¡¹ç›®çš„è®¸å¯è¯ã€‚

## ğŸ“š å¼•ç”¨

å¦‚æœæ‚¨åœ¨ç ”ç©¶ä¸­ä½¿ç”¨äº† CrystaLLMï¼Œè¯·å¼•ç”¨ï¼š

```bibtex
@article{antunes2024crystal,
  title={Crystal structure generation with autoregressive large language modeling},
  author={Antunes, Luis M and Butler, Keith T and Grau-Crespo, Ricardo},
  journal={Nature Communications},
  volume={15},
  number={1},
  pages={10761},
  year={2024},
  publisher={Nature Publishing Group UK London}
}
```

## ğŸ“ è”ç³»æ–¹å¼

- **GitHub Issues**: æŠ¥å‘Šé—®é¢˜æˆ–æé—®
- **è¯¦ç»†æŒ‡å—**: [PEROVSKITE_GENERATION_GUIDE.md](PEROVSKITE_GENERATION_GUIDE.md)
- **ç¤ºä¾‹æ–‡æ¡£**: [examples/README.md](examples/README.md)

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼å¦‚æœè¿™äº›å·¥å…·å¯¹æ‚¨çš„ç ”ç©¶æœ‰å¸®åŠ©ï¼Œæ¬¢è¿ç»™é¡¹ç›®ä¸€ä¸ª â­ï¼**
